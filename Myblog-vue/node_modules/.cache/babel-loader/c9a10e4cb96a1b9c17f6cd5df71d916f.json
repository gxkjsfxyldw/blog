{"remainingRequest":"D:\\MyBlog\\Myblog-vue\\node_modules\\thread-loader\\dist\\cjs.js!D:\\MyBlog\\Myblog-vue\\node_modules\\babel-loader\\lib\\index.js!D:\\MyBlog\\Myblog-vue\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\MyBlog\\Myblog-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\MyBlog\\Myblog-vue\\src\\views\\blog\\BlogWrite.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\MyBlog\\Myblog-vue\\src\\views\\blog\\BlogWrite.vue","mtime":1664856194439},{"path":"D:\\MyBlog\\Myblog-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1662220380556},{"path":"D:\\MyBlog\\Myblog-vue\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1662220379588},{"path":"D:\\MyBlog\\Myblog-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":1662220387677},{"path":"D:\\MyBlog\\Myblog-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1662220380556},{"path":"D:\\MyBlog\\Myblog-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":1662220386645}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.map\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport BaseHeader from \"@/components/common/BaseHeader\";\nimport MarkdownEditor from \"@/components/markdown/MarkdownEditor\";\nimport { publishArticle, getArticleById as _getArticleById } from \"@/api/article\";\nimport { getAllcategory } from \"@/api/category\";\nimport { getAlltags } from \"@/api/tag\";\nexport default {\n  name: \"BlogWrite\",\n  components: {\n    \"markdown-editor\": MarkdownEditor,\n    \"base-header\": BaseHeader\n  },\n  data: function data() {\n    return {\n      publishVisible: false,\n      categorys: [],\n      tags: [],\n      articleForm: {\n        id: '',\n        title: '',\n        summary: '',\n        category: '',\n        tags: [],\n        editor: {\n          value: '',\n          ref: '',\n          //保存mavonEditor实例  实际不该这样\n          default_open: 'edit',\n          toolbars: {\n            bold: true,\n            // 粗体\n            italic: true,\n            // 斜体\n            header: true,\n            // 标题\n            underline: true,\n            // 下划线\n            strikethrough: true,\n            // 中划线\n            mark: true,\n            // 标记\n            superscript: true,\n            // 上角标\n            subscript: true,\n            // 下角标\n            quote: true,\n            // 引用\n            ol: true,\n            // 有序列表\n            ul: true,\n            // 无序列表\n            imagelink: true,\n            // 图片链接\n            code: true,\n            // code\n            fullscreen: true,\n            // 全屏编辑\n            readmodel: true,\n            // 沉浸式阅读\n            help: true,\n            // 帮助\n            undo: true,\n            // 上一步\n            redo: true,\n            // 下一步\n            trash: true,\n            // 清空\n            navigation: true,\n            // 导航目录\n            //subfield: true, // 单双栏模式\n            preview: true // 预览\n\n          }\n        }\n      },\n      rules: {\n        summary: [{\n          required: true,\n          message: '请输入摘要',\n          trigger: 'blur'\n        }, {\n          max: 80,\n          message: '不能大于80个字符',\n          trigger: 'blur'\n        }],\n        category: [{\n          required: true,\n          message: '请选择文章分类',\n          trigger: 'change'\n        }],\n        tags: [{\n          type: 'array',\n          required: true,\n          message: '请选择标签',\n          trigger: 'change'\n        }]\n      }\n    };\n  },\n  computed: {\n    title: function title() {\n      return '写文章';\n    }\n  },\n  mounted: function mounted() {\n    if (this.$route.params.id) {\n      this.getArticleById(this.$route.params.id);\n    }\n\n    this.getCategorysAndTags();\n    this.editorToolBarToFixedWrapper = this.$_.throttle(this.editorToolBarToFixed, 200);\n    window.addEventListener('scroll', this.editorToolBarToFixedWrapper, false);\n  },\n  beforeDestroy: function beforeDestroy() {\n    window.removeEventListener('scroll', this.editorToolBarToFixedWrapper, false);\n  },\n  methods: {\n    getArticleById: function getArticleById(id) {\n      var _this = this;\n\n      alert(111);\n      var that = this;\n\n      _getArticleById(id).then(function (res) {\n        Object.assign(that.articleForm, res.data.data);\n        that.articleForm.editor.value = res.data.data.body.content;\n\n        var tags = _this.articleForm.tags.map(function (item) {\n          return item.id;\n        });\n\n        _this.articleForm.tags = tags;\n      }).catch(function (error) {\n        if (error !== 'error') {\n          that.$message({\n            type: 'error',\n            message: '文章加载失败',\n            showClose: true\n          });\n        }\n      });\n    },\n    publishShow: function publishShow() {\n      if (!this.articleForm.title) {\n        this.$message({\n          message: '标题不能为空哦',\n          type: 'warning',\n          showClose: true\n        });\n        return;\n      }\n\n      if (this.articleForm.title.length > 30) {\n        this.$message({\n          message: '标题不能大于30个字符',\n          type: 'warning',\n          showClose: true\n        });\n        return;\n      }\n\n      if (!this.articleForm.editor.ref.d_render) {\n        this.$message({\n          message: '内容不能为空哦',\n          type: 'warning',\n          showClose: true\n        });\n        return;\n      }\n\n      this.publishVisible = true;\n    },\n    publish: function publish(articleForm) {\n      var _this2 = this;\n\n      var that = this;\n      that.$refs[articleForm].validate(function (valid) {\n        if (valid) {\n          var tags = _this2.articleForm.tags.map(function (item) {\n            return {\n              id: item\n            };\n          });\n\n          var article = {\n            id: _this2.articleForm.id,\n            title: _this2.articleForm.title,\n            summary: _this2.articleForm.summary,\n            category: _this2.articleForm.category,\n            tags: tags,\n            body: {\n              content: _this2.articleForm.editor.value,\n              contentHtml: _this2.articleForm.editor.ref.d_render\n            }\n          };\n          _this2.publishVisible = false;\n\n          var loading = _this2.$loading({\n            lock: true,\n            text: '正在发布文章，请稍后...'\n          });\n\n          publishArticle(article, _this2.$store.state.token).then(function (res) {\n            if (res.data.success) {\n              loading.close();\n              that.$message({\n                message: '文章发布成功！',\n                type: 'success',\n                showClose: true\n              });\n              that.$router.push({\n                path: \"/view/\".concat(res.data.data.id)\n              });\n            } else {\n              that.$message({\n                message: '发布文章失败:' + res.data.msg,\n                type: 'error',\n                showClose: true\n              });\n            }\n          }).catch(function (error) {\n            loading.close();\n\n            if (error !== 'error') {\n              that.$message({\n                message: '发布文章失败:' + res.data.msg,\n                type: 'error',\n                showClose: true\n              });\n            }\n          });\n        }\n      });\n    },\n    cancel: function cancel() {\n      var _this3 = this;\n\n      this.$confirm('文章将不会保存，是否继续？', \"提示\", {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        _this3.$router.push('/');\n      });\n    },\n    getCategorysAndTags: function getCategorysAndTags() {\n      var _this4 = this;\n\n      var that = this;\n      getAllcategory().then(function (res) {\n        //发起http请求，后端的数据\n        if (res.data.success) {\n          that.categorys = res.data.data;\n        } else {\n          _this4.$message({\n            type: 'error',\n            message: '文章分类加载失败',\n            showClose: true\n          });\n        }\n      }).catch(function (err) {\n        if (err !== 'error') {\n          _this4.$message({\n            type: 'error',\n            message: '文章分类加载失败',\n            showClose: true\n          });\n        }\n      });\n      getAlltags().then(function (res) {\n        //发起http请求，后端的数据\n        if (res.data.success) {\n          that.tags = res.data.data;\n        } else {\n          _this4.$message({\n            type: 'error',\n            message: '标签加载失败',\n            showClose: true\n          });\n        }\n      }).catch(function (err) {\n        if (err !== 'error') {\n          that.$message({\n            type: 'error',\n            message: err.msg,\n            showClose: true\n          });\n        }\n      });\n    },\n    editorToolBarToFixed: function editorToolBarToFixed() {\n      var toolbar = document.querySelector('.v-note-op');\n      var curHeight = document.documentElement.scrollTop || document.body.scrollTop;\n\n      if (curHeight >= 160) {\n        document.getElementById(\"placeholder\").style.display = \"block\"; //bad  用计算属性较好\n\n        toolbar.classList.add(\"me-write-toolbar-fixed\");\n      } else {\n        document.getElementById(\"placeholder\").style.display = \"none\";\n        toolbar.classList.remove(\"me-write-toolbar-fixed\");\n      }\n    }\n  },\n  //组件内的守卫 调整body的背景色\n  beforeRouteEnter: function beforeRouteEnter(to, from, next) {\n    window.document.body.style.backgroundColor = '#fff';\n    next();\n  },\n  beforeRouteLeave: function beforeRouteLeave(to, from, next) {\n    window.document.body.style.backgroundColor = '#f5f5f5';\n    next();\n  }\n};",{"version":3,"sources":["BlogWrite.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div id=\"write\" v-title :data-title=\"title\">\r\n    <el-container>\r\n      <base-header :simple=true>\r\n        <el-col :span=\"4\" :offset=\"2\">\r\n          <div class=\"me-write-info\">写文章</div>\r\n        </el-col>\r\n        <el-col :span=\"3\" :offset=\"6\" style=\"margin-top: 1%;margin-left: 30%\">\r\n          <div class=\"me-write-bth\">\r\n            <el-button round @click=\"publishShow\">发布</el-button>\r\n            <el-button round @click=\"cancel\">取消</el-button>\r\n          </div>\r\n        </el-col>\r\n      </base-header>\r\n\r\n      <el-container class=\"me-area me-write-box\">\r\n        <el-main class=\"me-write-main\">\r\n          <div class=\"me-write-title\">\r\n            <el-input resize=\"none\"\r\n              type=\"textarea\"\r\n              autosize\r\n              v-model=\"articleForm.title\"\r\n              placeholder=\"请输入标题\"\r\n              class=\"me-write-input\">\r\n            </el-input>\r\n          </div>\r\n          <div>\r\n            <div id=\"placeholder\" style=\"visibility: hidden;height: 90px;display: none\"></div>\r\n            <markdown-editor :editor=\"articleForm.editor\" class=\"me-write-editor\"></markdown-editor>\r\n          </div>\r\n        </el-main>\r\n      </el-container>\r\n\r\n      <el-dialog title=\"摘要 分类 标签\"\r\n        :visible.sync=\"publishVisible\"\r\n        :close-on-click-modal=\"false\"\r\n        custom-class=\"me-dialog\">\r\n\r\n        <el-form :model=\"articleForm\" ref=\"articleForm\" :rules=\"rules\">\r\n          <el-form-item prop=\"summary\">\r\n            <el-input\r\n                type=\"textarea\"\r\n                v-model=\"articleForm.summary\"\r\n                :rows=\"6\"\r\n                placeholder=\"请输入摘要\">\r\n            </el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"文章分类\" prop=\"category\">\r\n            <el-select v-model=\"articleForm.category\" value-key=\"id\" placeholder=\"请选择文章分类\">\r\n              <el-option v-for=\" c in categorys\" :key=\"c.id\" :label=\"c.categoryName\" :value=\"c\"></el-option>\r\n            </el-select>\r\n          </el-form-item>\r\n          <el-form-item  label=\"文章标签\" prop=\"tags\">\r\n            <el-checkbox-group v-model=\"articleForm.tags\">\r\n              <el-checkbox v-for=\"t in tags\" :key=\"t.id\" :label=\"t.id\" name=\"tags\">{{t.tagName}}</el-checkbox>\r\n            </el-checkbox-group>\r\n          </el-form-item>\r\n        </el-form>\r\n        <div slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button type=\"primary\" @click=\"publish('articleForm')\">发布</el-button>\r\n          <el-button @click=\"publishVisible=false\">取消</el-button>\r\n        </div>\r\n      </el-dialog>\r\n    </el-container>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport BaseHeader from \"@/components/common/BaseHeader\";\r\nimport MarkdownEditor from \"@/components/markdown/MarkdownEditor\";\r\nimport {publishArticle, getArticleById} from \"@/api/article\";\r\nimport {getAllcategory} from \"@/api/category\";\r\nimport {getAlltags} from \"@/api/tag\";\r\n\r\n\r\nexport default {\r\n  name: \"BlogWrite\",\r\n  components: {\r\n   \"markdown-editor\": MarkdownEditor,\r\n   \"base-header\": BaseHeader\r\n  },\r\n  data(){\r\n      return{\r\n        publishVisible: false,\r\n        categorys: [],\r\n        tags:[],\r\n        articleForm:{\r\n                id: '',\r\n                title: '',\r\n                summary: '',\r\n                category: '',\r\n                tags: [],\r\n                editor: {\r\n                  value: '',\r\n                  ref: '',//保存mavonEditor实例  实际不该这样\r\n                  default_open: 'edit',\r\n                  toolbars: {\r\n                    bold: true, // 粗体\r\n                    italic: true, // 斜体\r\n                    header: true, // 标题\r\n                    underline: true, // 下划线\r\n                    strikethrough: true, // 中划线\r\n                    mark: true, // 标记\r\n                    superscript: true, // 上角标\r\n                    subscript: true, // 下角标\r\n                    quote: true, // 引用\r\n                    ol: true, // 有序列表\r\n                    ul: true, // 无序列表\r\n                    imagelink: true, // 图片链接\r\n                    code: true, // code\r\n                    fullscreen: true, // 全屏编辑\r\n                    readmodel: true, // 沉浸式阅读\r\n                    help: true, // 帮助\r\n                    undo: true, // 上一步\r\n                    redo: true, // 下一步\r\n                    trash: true, // 清空\r\n                    navigation: true, // 导航目录\r\n                    //subfield: true, // 单双栏模式\r\n                    preview: true, // 预览\r\n                  }\r\n                }\r\n            },\r\n        rules:{\r\n          summary:[\r\n            {required: true, message: '请输入摘要', trigger: 'blur'},\r\n            {max: 80, message: '不能大于80个字符', trigger: 'blur'}\r\n          ],\r\n          category: [\r\n            {required: true, message: '请选择文章分类', trigger: 'change'}\r\n          ],\r\n          tags: [\r\n            {type: 'array', required: true, message: '请选择标签', trigger: 'change'}\r\n          ]\r\n        }\r\n      }\r\n  },\r\n  computed:{\r\n      title(){\r\n        return '写文章'\r\n    }\r\n  },\r\n  mounted() {\r\n    if(this.$route.params.id){\r\n      this.getArticleById(this.$route.params.id)\r\n    }\r\n\r\n    this.getCategorysAndTags()\r\n    this.editorToolBarToFixedWrapper = this.$_.throttle(this.editorToolBarToFixed, 200)\r\n    window.addEventListener('scroll', this.editorToolBarToFixedWrapper, false);\r\n  },\r\n  beforeDestroy() {\r\n    window.removeEventListener('scroll', this.editorToolBarToFixedWrapper, false)\r\n  },\r\n  methods:{\r\n    getArticleById(id){\r\n      alert(111)\r\n      let that=this\r\n      getArticleById(id).then((res)=>{\r\n        Object.assign(that.articleForm,res.data.data)\r\n        that.articleForm.editor.value=res.data.data.body.content\r\n        let tags=this.articleForm.tags.map(function (item){\r\n          return item.id;\r\n        })\r\n        this.articleForm.tags=tags;\r\n      }).catch(error => {\r\n        if (error !== 'error') {\r\n          that.$message({type: 'error', message: '文章加载失败', showClose: true})\r\n        }\r\n      })\r\n    },\r\n    publishShow(){\r\n      if(!this.articleForm.title){\r\n        this.$message({message:'标题不能为空哦',type:'warning',showClose:true})\r\n        return\r\n      }\r\n      if (this.articleForm.title.length > 30) {\r\n        this.$message({message:'标题不能大于30个字符',type:'warning',showClose:true})\r\n        return\r\n      }\r\n      if(!this.articleForm.editor.ref.d_render){\r\n        this.$message({message:'内容不能为空哦',type:'warning',showClose:true})\r\n        return\r\n      }\r\n      this.publishVisible=true;\r\n    },\r\n    publish(articleForm){\r\n      let that=this\r\n\r\n      that.$refs[articleForm].validate((valid) => {\r\n        if(valid) {\r\n          let tags=this.articleForm.tags.map(function (item) {\r\n            return {id: item};\r\n          });\r\n\r\n          let article={\r\n            id:this.articleForm.id,\r\n            title:this.articleForm.title,\r\n            summary:this.articleForm.summary,\r\n            category:this.articleForm.category,\r\n            tags: tags,\r\n            body:{\r\n              content:this.articleForm.editor.value,\r\n              contentHtml:this.articleForm.editor.ref.d_render\r\n            }\r\n          }\r\n          this.publishVisible=false;\r\n          let loading =this.$loading({\r\n            lock:true,\r\n            text:'正在发布文章，请稍后...'\r\n          })\r\n\r\n          publishArticle(article,this.$store.state.token).then((res)=>{\r\n            if(res.data.success){\r\n              loading.close();\r\n              that.$message({message:'文章发布成功！',type:'success',showClose:true})\r\n              that.$router.push({path:`/view/${res.data.data.id}`})\r\n            }else{\r\n              that.$message({message:'发布文章失败:'+res.data.msg,type:'error',showClose:true})\r\n            }\r\n          }).catch((error)=>{\r\n            loading.close();\r\n            if(error!=='error'){\r\n              that.$message({message:'发布文章失败:'+res.data.msg,type:'error',showClose:true})\r\n            }\r\n          })\r\n        }\r\n      });\r\n    },\r\n    cancel(){\r\n        this.$confirm('文章将不会保存，是否继续？',\"提示\",{\r\n          confirmButtonText:'确定',\r\n          cancelButtonText:'取消',\r\n          type:'warning'\r\n        }).then(()=>{\r\n          this.$router.push('/')\r\n        })\r\n    },\r\n\r\n    getCategorysAndTags(){\r\n      let that=this\r\n      getAllcategory().then((res)=>{\r\n        //发起http请求，后端的数据\r\n          if(res.data.success){\r\n            that.categorys = res.data.data\r\n          }else{\r\n            this.$message({type: 'error', message: '文章分类加载失败', showClose: true})\r\n          }\r\n        }).catch((err)=>{\r\n          if (err !== 'error') {\r\n            this.$message({type: 'error', message: '文章分类加载失败', showClose: true})\r\n          }\r\n        })\r\n      getAlltags().then((res)=>{\r\n        //发起http请求，后端的数据\r\n        if(res.data.success){\r\n          that.tags = res.data.data\r\n        }else{\r\n          this.$message({type: 'error', message: '标签加载失败', showClose: true})\r\n        }\r\n      }).catch((err)=>{\r\n        if (err !== 'error') {\r\n          that.$message({type: 'error', message: err.msg, showClose: true})\r\n        }\r\n      })\r\n\r\n    },\r\n    editorToolBarToFixed() {\r\n      let toolbar = document.querySelector('.v-note-op');\r\n      let curHeight = document.documentElement.scrollTop || document.body.scrollTop;\r\n      if (curHeight >= 160) {\r\n        document.getElementById(\"placeholder\").style.display = \"block\"; //bad  用计算属性较好\r\n        toolbar.classList.add(\"me-write-toolbar-fixed\");\r\n      } else {\r\n        document.getElementById(\"placeholder\").style.display = \"none\";\r\n        toolbar.classList.remove(\"me-write-toolbar-fixed\");\r\n      }\r\n    }\r\n  },\r\n  //组件内的守卫 调整body的背景色\r\n  beforeRouteEnter(to, from, next) {\r\n    window.document.body.style.backgroundColor = '#fff';\r\n    next();\r\n  },\r\n  beforeRouteLeave(to, from, next) {\r\n    window.document.body.style.backgroundColor = '#f5f5f5';\r\n    next();\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.el-header {\r\n  position: fixed;\r\n  z-index: 1024;\r\n  min-width: 100%;\r\n  box-shadow: 0 2px 3px hsla(0, 0%, 7%, .1), 0 0 0 1px hsla(0, 0%, 7%, .1);\r\n}\r\n\r\n.me-write-info {\r\n  line-height: 60px;\r\n  font-size: 18px;\r\n  font-weight: 600;\r\n  margin-left: -20%;\r\n}\r\n\r\n.me-write-btn {\r\n  margin-top: 10px;\r\n}\r\n\r\n.me-write-box {\r\n  max-width: 1000px;\r\n  margin: 80px auto 0;\r\n}\r\n\r\n.me-write-main {\r\n  padding: 0;\r\n}\r\n\r\n.me-write-title {\r\n}\r\n\r\n.me-write-input textarea {\r\n  font-size: 32px;\r\n  font-weight: 600;\r\n  height: 20px;\r\n  border: none;\r\n}\r\n\r\n.me-write-editor {\r\n  min-height: 650px !important;\r\n}\r\n\r\n.me-header-left {\r\n  margin-top: 10px;\r\n}\r\n\r\n.me-title img {\r\n  max-height: 2.4rem;\r\n  max-width: 100%;\r\n}\r\n\r\n.me-write-toolbar-fixed {\r\n  position: fixed;\r\n  width: 700px !important;\r\n  top: 60px;\r\n}\r\n\r\n.v-note-op {\r\n  box-shadow: none !important;\r\n}\r\n\r\n.auto-textarea-input, .auto-textarea-block {\r\n  font-size: 18px !important;\r\n}\r\n</style>\r\n"],"sourceRoot":"src/views/blog"}]}